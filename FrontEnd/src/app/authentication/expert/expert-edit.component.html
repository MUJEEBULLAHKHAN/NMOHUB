<div class="multi-step-container">
  <div class="form-card">
    <div class="step-indicator">
      <div class="step-indicator-inner">
        <div class="step-circle" (click)="GoToStep(1)" [ngClass]="step == 1 ? 'active' : 'inactive'">1</div>
        <h6 class="step-form-title" *ngIf="step == 1">Personal Details</h6>
        <div class="step-connector incomplete"></div>
        <div class="step-circle" (click)="GoToStep(2)" [ngClass]="step == 2 ? 'active' : 'inactive'">2</div>
        <h6 class="step-form-title" *ngIf="step == 2">Professional Details</h6>
        <div class="step-connector incomplete"></div>
        <div class="step-circle" (click)="GoToStep(3)" [ngClass]="step == 3 ? 'active' : 'inactive'">3</div>
        <h6 class="step-form-title" *ngIf="step == 3">Review & Save</h6>
      </div>
    </div>

    <div *ngIf="loading">Loading...</div>
    <div *ngIf="!loading && error" class="error-message">{{ error }}</div>

    <form *ngIf="!loading && expert" (ngSubmit)="save()" class="form-content">
      <div class="step-content" *ngIf="step == 1">
        <div class="form-field">
          <div class="input-group">
            <span class="input-group-text label-group"><label class="form-label mb-0">Full Name</label></span>
            <input type="text" [(ngModel)]="expert.fullName" name="fullName" class="form-control form-input custom-input" placeholder="Enter full name" />
          </div>
        </div>
        <!-- <div class="form-field">
          <div class="input-group">
            <span class="input-group-text label-group"><label class="form-label mb-0">Email</label></span>
            <input type="email" [(ngModel)]="expert.email" name="email" class="form-control form-input custom-input" placeholder="Enter email" />
          </div>
        </div> -->
        <div class="form-field">
          <div class="input-group">
            <span class="input-group-text label-group"><label class="form-label mb-0">Phone Number</label></span>
            <input type="text" [(ngModel)]="expert.phoneNumber" name="phoneNumber" class="form-control form-input custom-input" placeholder="Phone number" />
          </div>
        </div>
        <div class="form-field">
          <div class="input-group">
            <span class="input-group-text label-group"><label class="form-label mb-0">Nationality</label></span>
            <input type="text" [(ngModel)]="expert.nationality" name="nationality" class="form-control form-input custom-input" placeholder="Nationality" />
          </div>
        </div>
        <div class="form-field">
          <div class="input-group">
            <span class="input-group-text label-group"><label class="form-label mb-0">ID Type</label></span>
            <select [(ngModel)]="expert.idType" name="idType" class="form-control form-input custom-input">
              <option value="" disabled>Select ID Type</option>
              <option *ngFor="let t of idTypeOptions" [value]="t">{{ t }}</option>
            </select>
          </div>
        </div>
        <div class="form-field">
          <div class="input-group">
            <span class="input-group-text label-group"><label class="form-label mb-0">ID Number</label></span>
            <input type="text" [(ngModel)]="expert.idNumber" name="idNumber" class="form-control form-input custom-input" placeholder="Enter ID number" />
          </div>
        </div>
      </div>

      <div class="step-content" *ngIf="step == 2">
        <div class="form-field">
          <div class="input-group">
            <span class="input-group-text label-group"><label class="form-label mb-0">Profile Picture</label></span>
            <input type="file" accept="image/*" (change)="onProfilePictureSelected($event)" class="form-control form-input custom-input" />
          </div>
          <div class="profile-preview" *ngIf="expert.profilePicture">
            <img [src]="expert.profilePicture" alt="Profile preview" />
          </div>
          <div class="profile-preview" *ngIf="!expert.profilePicture">
            <div class="avatar-placeholder-large">
              <i class="bi bi-person-fill"></i>
              <div class="placeholder-text">No profile picture</div>
            </div>
          </div>
        </div>
        <div class="form-field">
          <div class="input-group">
            <span class="input-group-text label-group"><label class="form-label mb-0">Experience Years</label></span>
            <input type="number" [(ngModel)]="expert.experienceYears" name="experienceYears" class="form-control form-input custom-input" placeholder="e.g. 5" />
          </div>
        </div>
        <div class="form-field">
          <div class="input-group">
            <span class="input-group-text label-group"><label class="form-label mb-0">Education Details</label></span>
            <input type="text" [(ngModel)]="expert.educationDetails" name="educationDetails" class="form-control form-input custom-input" placeholder="Your education" />
          </div>
        </div>
        <div class="form-field">
          <div class="input-group">
            <span class="input-group-text label-group"><label class="form-label mb-0">LinkedIn URL</label></span>
            <input type="text" [(ngModel)]="expert.linkedInProfileURL" name="linkedInProfileURL" class="form-control form-input custom-input" placeholder="https://linkedin.com/in/..." />
          </div>
        </div>
        <div class="form-field">
          <div class="input-group">
            <span class="input-group-text label-group"><label class="form-label mb-0">Areas of Expertise</label></span>
            <div class="form-control form-input custom-input">
              <!-- Debug info -->
              <div *ngIf="areasOfExpertise.length === 0" class="text-muted small">
                Loading areas of expertise...
              </div>
              <div *ngIf="areasOfExpertise.length > 0" class="areas-container">
                <div class="area-item" *ngFor="let area of areasOfExpertise">
                  <div class="form-check">
                    <input 
                      class="form-check-input" 
                      type="checkbox" 
                      [id]="'area-' + area.areaOfExpertiseID"
                      [checked]="isAreaSelected(area.areaOfExpertiseID)"
                      (change)="onAreaOfExpertiseChange(area.areaOfExpertiseID, $event)"
                    />
                    <label class="form-check-label" [for]="'area-' + area.areaOfExpertiseID">
                      {{ area.name }}
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="status-toggle">
          <label class="switch">
            <input type="checkbox" [checked]="isActive()" (change)="onStatusToggle($event)" />
            <span class="slider"></span>
          </label>
          <span class="status-label" [class.active]="isActive()" [class.inactive]="!isActive()">{{ isActive() ? 'Active' : 'Inactive' }}</span>
        </div>
      </div>

      <div class="step-content" *ngIf="step == 3">
        <div class="form-field">
          <label class="form-label">Review changes</label>
          <div class="form-input">
            <div><strong>Name:</strong> {{ expert.fullName }}</div>
            <div><strong>Email:</strong> {{ expert.email }}</div>
            <div><strong>Phone:</strong> {{ expert.phoneNumber }}</div>
            <div><strong>Experience:</strong> {{ expert.experienceYears }}</div>
            <div><strong>LinkedIn:</strong> {{ expert.linkedInProfileURL }}</div>
            <div><strong>Areas of Expertise:</strong> 
              <span *ngIf="expert.areaOfExpertise.length === 0">None selected</span>
              <span *ngIf="expert.areaOfExpertise.length > 0">
                {{ getSelectedAreasNames() }}
              </span>
            </div>
            <div><strong>Status:</strong> {{ isActive() ? 'Active' : 'Inactive' }}</div>
          </div>
        </div>
      </div>

      <div class="form-navigation">
        <button type="button" class="nav-button previous-button" [disabled]="step <= 1" (click)="GoToPrevious()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m15 18-6-6 6-6" /></svg>
          Previous
        </button>

        <button type="button" class="nav-button next-button" *ngIf="step < lastStep" (click)="GoToNext()">
          Next
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m9 18 6-6-6-6" /></svg>
        </button>

        <button type="submit" class="nav-button next-button" *ngIf="step == lastStep" [disabled]="saving">
          Save Changes
        </button>
      </div>
    </form>
  </div>
</div>


