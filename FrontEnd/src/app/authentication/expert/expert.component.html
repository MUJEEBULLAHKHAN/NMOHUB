<div class="multi-step-container" id="div">
  <div class="form-card">
    <div class="step-indicator">
      <div class="step-indicator-inner">
        <div class="step-circle" (click)="GoToStep(1)" [ngClass]="step == 1 ? 'active' : 'inactive'">1</div>
        <h6 class="step-form-title" *ngIf="step == 1">Personal Details</h6>
        <div class="step-connector incomplete"></div>
        <div class="step-circle" (click)="GoToStep(2)" [ngClass]="step == 2 ? 'active' : 'inactive'">2</div>
        <h6 class="step-form-title" *ngIf="step == 2">Professional Details</h6>
        <div class="step-connector incomplete"></div>
        <div class="step-circle" (click)="GoToStep(3)" [ngClass]="step == 3 ? 'active' : 'inactive'">3</div>
        <h6 class="step-form-title" *ngIf="step == 3">Review & Submit</h6>
      </div>
    </div>

    <div class="form-content">
      <div class="step-content" *ngIf="step == 1">
        <div class="form-field">
          <div class="input-group">
            <span class="input-group-text label-group"><label class="form-label mb-0">Full Name</label></span>
            <input type="text" [(ngModel)]="expert.fullName" name="fullName"
              class="form-control form-input custom-input" placeholder="Enter your full name" />
            <span class="input-group-text icon-group" *ngIf="expert.fullName"><i class="bi bi-check-lg"></i></span>
          </div>
          <div class="error-message" *ngIf="expert.fullName && expert.fullName.trim().length < 2">Full name must be at
            least 2 characters</div>
        </div>
        <div class="form-field">
          <div class="input-group">
            <span class="input-group-text label-group"><label class="form-label mb-0">Email</label></span>
            <input type="email" [(ngModel)]="expert.email" name="email" class="form-control form-input custom-input"
              placeholder="Enter your email" />
            <span class="input-group-text icon-group" *ngIf="isValidForSubmit()"><i class="bi bi-check-lg"></i></span>
          </div>
          <div class="error-message" *ngIf="expert.email && !isValidForSubmit()">Enter a valid email address</div>
        </div>
        <div class="form-field">
          <div class="input-group">
            <span class="input-group-text label-group"><label class="form-label mb-0">Phone Number</label></span>
            <input type="text" [(ngModel)]="expert.phoneNumber" name="phoneNumber"
              class="form-control form-input custom-input" placeholder="Enter your phone number" />
          </div>
        </div>
        <div class="form-field">
          <div class="input-group">
            <span class="input-group-text label-group"><label class="form-label mb-0">Nationality</label></span>
            <input type="text" [(ngModel)]="expert.nationality" name="nationality"
              class="form-control form-input custom-input" placeholder="Nationality" />
          </div>
        </div>
        <div class="form-field">
          <div class="input-group">
            <span class="input-group-text label-group"><label class="form-label mb-0">ID Type</label></span>
            <select [(ngModel)]="expert.idType" name="idType" class="form-control form-input custom-input">
              <option value="" disabled selected>Select ID Type</option>
              <option *ngFor="let t of idTypeOptions" [value]="t">{{ t }}</option>
            </select>
          </div>
        </div>
        <div class="form-field">
          <div class="input-group">
            <span class="input-group-text label-group"><label class="form-label mb-0">ID Number</label></span>
            <input type="text" [(ngModel)]="expert.idNumber" name="idNumber"
              class="form-control form-input custom-input" placeholder="Enter ID number" />
          </div>
        </div>
      </div>

      <div class="step-content" *ngIf="step == 2">
        <div class="form-field">
          <div class="input-group">
            <span class="input-group-text label-group"><label class="form-label mb-0">Profile Picture</label></span>
            <input type="file" accept="image/*" (change)="onProfilePictureSelected($event)"
              class="form-control form-input custom-input" />
          </div>
          <div class="profile-preview" *ngIf="expert.profilePicture">
            <img [src]="expert.profilePicture" alt="Profile preview" />
          </div>
          <div class="profile-preview" *ngIf="!expert.profilePicture">
            <div class="avatar-placeholder-large">
              <i class="bi bi-person-fill"></i>
              <div class="placeholder-text">No profile picture</div>
            </div>
          </div>
        </div>
        <div class="form-field">
          <div class="input-group">
            <span class="input-group-text label-group"><label class="form-label mb-0">Experience Years</label></span>
            <input type="number" [(ngModel)]="expert.experienceYears" name="experienceYears"
              class="form-control form-input custom-input" placeholder="e.g. 5" />
          </div>
        </div>
        <div class="form-field">
          <div class="input-group">
            <span class="input-group-text label-group"><label class="form-label mb-0">Education Details</label></span>
            <input type="text" [(ngModel)]="expert.educationDetails" name="educationDetails"
              class="form-control form-input custom-input" placeholder="Your education" />
          </div>
        </div>
        <div class="form-field">
          <div class="input-group">
            <span class="input-group-text label-group"><label class="form-label mb-0">LinkedIn URL</label></span>
            <input type="text" [(ngModel)]="expert.linkedInProfileURL" name="linkedInProfileURL"
              class="form-control form-input custom-input" placeholder="https://linkedin.com/in/.." />
          </div>
        </div>
        <div class="form-field">
          <div class="input-group">
            <span class="input-group-text label-group"><label class="form-label mb-0">Areas of Expertise</label></span>
            <div class="form-control form-input custom-input">
              <!-- Debug info -->
              <!-- <div class="debug-info" style="font-size: 12px; color: #666; margin-bottom: 10px;">
                Debug: {{ areasOfExpertise.length }} areas loaded
              </div> -->
              <div *ngIf="areasOfExpertise.length === 0" class="text-muted small">
                Loading areas of expertise...
              </div>
              <div *ngIf="areasOfExpertise.length > 0" class="areas-container">
                <!-- Simple test list first -->
                <!-- <div *ngFor="let area of areasOfExpertise"
                  style="margin: 5px 0; padding: 5px; background: #f0f0f0; border-radius: 3px;">
                  {{ area.name }} (ID: {{ area.areaOfExpertiseID }})
                </div> -->

                <!-- Checkbox version -->
                <!-- <div class="area-item" *ngFor="let area of areasOfExpertise">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" [id]="'area-' + area.areaOfExpertiseID"
                      [checked]="isAreaSelected(area.areaOfExpertiseID)"
                      (change)="onAreaOfExpertiseChange(area.areaOfExpertiseID, $event)" />
                    <label class="form-check-label" [for]="'area-' + area.areaOfExpertiseID">
                      {{ area.name }}
                    </label>
                  </div>
                </div> -->

                <div class="row">
                  <ng-select class="" [(ngModel)]="selectedTag" data-trigger name="Payment" id="payment"
                    [multiple]="true" [hideSelected]="true" [(ngModel)]="selected">
                    <ng-option *ngFor="let area of areasOfExpertise"
                      value="{{area.areaOfExpertiseID}}">{{area.name}}</ng-option>
                  </ng-select>
                </div>


              </div>
            </div>
          </div>
        </div>
        <!-- <div class="form-field">
          <div class="input-group">
            <span class="input-group-text label-group"><label class="form-label mb-0">Status</label></span>
            <input type="text" [(ngModel)]="expert.status" name="status" class="form-control form-input custom-input" placeholder="Active / Inactive" />
          </div>
        </div> -->
      </div>

      <div class="step-content" *ngIf="step == 3">
        <div class="form-field">
          <label class="form-label">Confirm details and submit</label>
          <div class="form-input">
            <div><strong>Name:</strong> {{ expert.fullName }}</div>
            <div><strong>Email:</strong> {{ expert.email }}</div>
            <div><strong>Phone:</strong> {{ expert.phoneNumber }}</div>
            <div><strong>Experience:</strong> {{ expert.experienceYears }}</div>
            <div><strong>LinkedIn:</strong> {{ expert.linkedInProfileURL }}</div>
            <div><strong>Areas of Expertise:</strong>
              <span *ngIf="expert.areaOfExpertise.length === 0">None selected</span>
              <span *ngIf="expert.areaOfExpertise.length > 0">
                {{ getSelectedAreasNames() }}
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="form-navigation">
      <button type="button" class="nav-button previous-button" [disabled]="step <= 1" (click)="GoToPrevious()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="m15 18-6-6 6-6" />
        </svg>
        Previous
      </button>

      <button type="button" class="nav-button next-button" *ngIf="step < lastStep" (click)="GoToNext()">
        Next
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="m9 18 6-6-6-6" />
        </svg>
      </button>

      <button type="button" class="nav-button next-button" *ngIf="step == lastStep" (click)="onSubmit()"
        [disabled]="!isValidForSubmit()">
        Submit

        <span role="status" aria-hidden="true" class="spinner-border spinner-border-sm align-middle"
          *ngIf="showLoader"></span>
      </button>
    </div>

    <!-- Footer -->
    <div class="form-footer">
      <p class="footer-text">
        Already have an account?
        <a href="/customer-register" class="footer-link">Sign Up</a>
      </p>
      <p class="footer-text">
        Go To Home
        <a href="/home" class="footer-link">Home</a>
      </p>
    </div>

    <div class="form-footer">
      <p class="footer-text">{{ responseMessage }}</p>
    </div>
  </div>
</div>